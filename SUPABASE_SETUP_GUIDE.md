# ðŸ”— How to Connect Your Supabase Database to Your Website

## Step 1: Get Your Supabase Credentials

1. **Go to Supabase**:
   - Open your browser and go to [supabase.com](https://supabase.com)
   - Click "Sign In" and log into your account

2. **Open Your Project**:
   - You'll see your project(s) listed
   - Click on the project you want to connect

3. **Find Your API Keys**:
   - On the left sidebar, click the âš™ï¸ **Settings** icon (at the bottom)
   - Click **API** from the menu
   - You'll see two important things:
     - **Project URL** (looks like: `https://xxxxxxxxxxxxx.supabase.co`)
     - **anon/public key** (a long text string)

4. **Copy These**:
   - Copy the **Project URL** somewhere safe (like Notepad)
   - Copy the **anon public key** somewhere safe
   - âš ï¸ Keep these private! Don't share them publicly

---

## Step 2: Create Your Environment File

1. **Open Your Project Folder**:
   - Go to: `C:\Users\DELL\Downloads\ecommerce-website-design`

2. **Create a New File**:
   - Right-click in the folder
   - Choose "New" â†’ "Text Document"
   - Name it **exactly**: `.env.local` (including the dots!)
   - âš ï¸ Important: Make sure it's not named `.env.local.txt`

3. **Open the File**:
   - Right-click the `.env.local` file
   - Choose "Open with Notepad"

4. **Add Your Credentials**:
   - Copy and paste this into the file:

```
NEXT_PUBLIC_SUPABASE_URL=paste_your_project_url_here
NEXT_PUBLIC_SUPABASE_ANON_KEY=paste_your_anon_key_here
```

5. **Replace the Values**:
   - Replace `paste_your_project_url_here` with your actual Project URL
   - Replace `paste_your_anon_key_here` with your actual anon key

   Example:

```
NEXT_PUBLIC_SUPABASE_URL=https://abcdefghijk.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFi...
```

6. **Save the File**:
   - Press `Ctrl + S` to save
   - Close Notepad

---

## Step 3: Set Up Your Database (SQL Editor)

The easiest way to set up your database is using the **SQL Editor** in Supabase. This will create both the `products` and `carts` tables with the correct settings.

1.  **Open Supabase Dashboard**:
    - Click the âž¡ï¸ **SQL Editor** icon on the left sidebar (looks like `>_`).
2.  **Create New Query**:
    - Click **"New query"**.
3.  **Paste & Run**:
    - Copy and paste the entire block of code below into the editor.
    - Click the **"Run"** button (or press `Ctrl + Enter`).

```sql
-- 1. Create Products Table
create table if not exists public.products (
  id bigint generated by default as identity not null,
  product_name text not null,          -- Name of the product
  category text not null,              -- e.g., 'Vegetables', 'Fruits'
  description text,                    -- Product details
  price numeric(10, 2) not null,       -- Current price
CREATE TABLE products (
  id TEXT PRIMARY KEY,
  product_name TEXT NOT NULL,           -- Updated from name
  urdu_name TEXT,
  description TEXT,
  price DECIMAL(10, 2) NOT NULL,
  original_price DECIMAL(10, 2),
  category TEXT NOT NULL,
  image_url TEXT,                      -- Updated from image
  unit TEXT DEFAULT 'grams',
  min_quantity INTEGER DEFAULT 1,      -- Updated from minQuantity
  stock_quantity INTEGER DEFAULT 10,   -- Added, inStock is now derived
  variants JSONB,
  bulk_discounts JSONB,
  reviews INTEGER DEFAULT 0,
  rating DECIMAL(3, 2) DEFAULT 0,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- 2. Create Carts Table
CREATE TABLE carts (
  user_id UUID REFERENCES auth.users ON DELETE CASCADE PRIMARY KEY,
  items JSONB NOT NULL DEFAULT '[]'::jsonb,
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- 3. Enable Public Access for Products
alter table public.products enable row level security;
create policy "Allow public read access" on public.products for select using (true);
create policy "Allow admin insert" on public.products for insert with check (true);
create policy "Allow admin update" on public.products for update using (true);

-- 4. Enable Private Access for Carts
alter table public.carts enable row level security;
create policy "Users can manage their own carts"
on public.carts for all
using (auth.uid() = user_id)
with check (auth.uid() = user_id);
```

4.  **Important: Refresh Schema Cache**:
    - If you get an "items column not found" or "schema cache" error, you may need to wait 1-2 minutes for Supabase to update, or restart your website's terminal.

---

## Step 4: Test the Connection

1. **Restart Your Development Server**:
   - If your website is running, stop it (press `Ctrl + C` in the terminal)
   - Start it again with: `npm run dev`

2. **Test Adding a Product**:
   - Go to your website
   - Navigate to `/admin/add-product`
   - Try adding a test product
   - If it works, you're connected! ðŸŽ‰

---

## Common Issues & Solutions

### âŒ "Cannot find .env.local file"

- Make sure the file is named `.env.local` (not `.env.local.txt`)
- Make sure it's in the root folder: `C:\Users\DELL\Downloads\ecommerce-website-design`

### âŒ "Supabase error: relation 'products' does not exist"

- You haven't created the `products` table in Supabase yet
- Run the SQL code in Step 3.

### âŒ "items column of carts in the schema cache"

- This means the `carts` table exists but Supabase hasn't "noticed" the new columns yet.
- **Solution**: Run the SQL in Step 3 again (it uses `if not exists` so it won't break anything) or just wait 1 minute.

---

## ðŸŽ¯ Quick Checklist

- [ ] I have my Supabase Project URL and anon key in `.env.local`
- [ ] I ran the SQL code in the **SQL Editor**
- [ ] I see both `products` and `carts` tables in the **Table Editor**
- [ ] I restarted my development server
- [ ] I can successfully login and sync my cart

---

## Step 5: Setting Up Google Login (OAuth)

If you want customers to log in with Google, follow these steps exactly:

### 1. Google Cloud Console

1. Go to the [Google Cloud Console](https://console.cloud.google.com/).
2. Select your project (or create a new one).
3. Go to **APIs & Services** > **Credentials**.
4. Click **Create Credentials** > **OAuth client ID**.
5. Select **Web application**.
6. **Authorized redirect URIs**: Add this EXACT URL:
   `https://ublxzgwpepwedxnbdeof.supabase.co/auth/v1/callback`
7. Click **Create**.
8. Copy your **Client ID** and **Client Secret**.

### 2. Supabase Dashboard

1. Open your [Supabase Dashboard](https://supabase.com/dashboard).
2. Go to **Authentication** > **Providers**.
3. Find **Google** and click to expand.
4. Paste the **Client ID** and **Client Secret** you got from Google.
5. Click **Save**.

### 3. Verification

1. Go to your local website's login page.
2. Click **"Continue with Google"**.
3. It should now successfully ask you to pick a Google account!

---

## Need More Help?

If you're still having issues, take a screenshot of:

1. Your Supabase dashboard showing the **Table Editor**
2. Your `.env.local` file (blur out the keys!)
3. Any error messages you see

And I'll help you troubleshoot! ðŸ˜Š
